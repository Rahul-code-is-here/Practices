CREATE TABLE IF NOT EXISTS Roles (
    role_id SERIAL PRIMARY KEY,
    role_name VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_role_name CHECK (role_name <> '')
);

CREATE TABLE IF NOT EXISTS Users (
    user_id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    username VARCHAR(255) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20),
    role_id INTEGER NOT NULL,
    status VARCHAR(50) CHECK (status IN ('Active', 'Inactive')) DEFAULT 'Active',
    country_id INTEGER NOT NULL,
    state_id INTEGER NOT NULL,
    city_id INTEGER NOT NULL,
    address_line1 VARCHAR(255),
    zipcode VARCHAR(10),
    address TEXT,
    profile_image VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    CONSTRAINT chk_email CHECK (LOWER(email) LIKE '%@%.%')
);

CREATE TABLE IF NOT EXISTS Permissions (
    permission_id SERIAL PRIMARY KEY,
    role_id INTEGER NOT NULL,
    module VARCHAR(255) NOT NULL,
    can_view BOOLEAN NOT NULL DEFAULT FALSE,
    can_add_edit BOOLEAN NOT NULL DEFAULT FALSE,
    can_delete BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES Roles(role_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Countries (
    country_id SERIAL PRIMARY KEY,
    country_name VARCHAR(255) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS States (
    state_id SERIAL PRIMARY KEY,
    country_id INTEGER NOT NULL,
    state_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (country_id) REFERENCES Countries(country_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Cities (
    city_id SERIAL PRIMARY KEY,
    state_id INTEGER NOT NULL,
    city_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (state_id) REFERENCES States(state_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS MenuItems (
    menu_item_id SERIAL PRIMARY KEY,
    category_id INTEGER NOT NULL,
    item_name VARCHAR(255) NOT NULL,
    item_type VARCHAR(50) CHECK (item_type IN ('Vegetarian', 'Non-Vegetarian', 'Vegan')) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    quantity INTEGER NOT NULL,
    unit VARCHAR(50) NOT NULL,
    is_available BOOLEAN NOT NULL DEFAULT TRUE,
    default_tax BOOLEAN NOT NULL DEFAULT FALSE,
    tax_percentage DECIMAL(5, 2) NOT NULL,
    short_code VARCHAR(50) NOT NULL,
    description TEXT,
    image_path VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (category_id) REFERENCES Categories(category_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS ModifierGroups (
    modifier_group_id SERIAL PRIMARY KEY,
    modifier_group_name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS Modifiers (
    modifier_id SERIAL PRIMARY KEY,
    modifier_group_id INTEGER NOT NULL,
    modifier_name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    unit VARCHAR(50) NOT NULL,
    quantity INTEGER NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (modifier_group_id) REFERENCES ModifierGroups(modifier_group_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS MenuItemModifierGroup (
    menu_item_id INTEGER NOT NULL,
    modifier_group_id INTEGER NOT NULL,
    PRIMARY KEY (menu_item_id, modifier_group_id),
    FOREIGN KEY (menu_item_id) REFERENCES MenuItems(menu_item_id) ON DELETE RESTRICT,
    FOREIGN KEY (modifier_group_id) REFERENCES ModifierGroups(modifier_group_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS ModifierGroupModifier (
    modifier_group_id INTEGER NOT NULL,
    modifier_id INTEGER NOT NULL,
    PRIMARY KEY (modifier_group_id, modifier_id),
    FOREIGN KEY (modifier_group_id) REFERENCES ModifierGroups(modifier_group_id) ON DELETE RESTRICT,
    FOREIGN KEY (modifier_id) REFERENCES Modifiers(modifier_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Tables (
    table_id SERIAL PRIMARY KEY,
    section_id INTEGER NOT NULL,
    table_name VARCHAR(255) NOT NULL,
    capacity INTEGER NOT NULL,
    status VARCHAR(50) CHECK (status IN ('Available', 'Occupied')) NOT NULL DEFAULT 'Available',
    FOREIGN KEY (section_id) REFERENCES Sections(section_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Sections (
    section_id SERIAL PRIMARY KEY,
    section_name VARCHAR(255) NOT NULL,
    description TEXT
);

CREATE TABLE IF NOT EXISTS Orders (
    order_id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    table_id INTEGER NOT NULL,
    status VARCHAR(50) CHECK (status IN ('Pending', 'In Progress', 'Completed', 'Cancelled')) NOT NULL DEFAULT 'Pending',
    payment_mode VARCHAR(50) NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE RESTRICT,
    FOREIGN KEY (table_id) REFERENCES Tables(table_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Order_Item (
    order_item_id SERIAL PRIMARY KEY,
    order_id INTEGER NOT NULL,
    item_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id) ON DELETE RESTRICT,
    FOREIGN KEY (item_id) REFERENCES MenuItems(menu_item_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Tax (
    tax_id SERIAL PRIMARY KEY,
    tax_name VARCHAR(255) NOT NULL,
    tax_type VARCHAR(255) NOT NULL,
    tax_value DECIMAL(10, 2) NOT NULL,
    is_default BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS Customers (
    customer_id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    address TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS Waiting_Tokens (
    token_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    section_id INTEGER NOT NULL,
    no_of_persons INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    waiting_time INTEGER,
    FOREIGN KEY (customer_id) REFERENCES Customers(customer_id) ON DELETE RESTRICT,
    FOREIGN KEY (section_id) REFERENCES Sections(section_id) ON DELETE RESTRICT
)
